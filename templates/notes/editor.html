{% extends "base.html" %}
{% block title %}{{ 'Edit' if mode == 'edit' else 'New' }} Note{% endblock %}

{% block content %}
<div class="section-header">
    <h1>{{ 'âœï¸ Edit Note' if mode == 'edit' else 'ğŸ“ New Note' }}</h1>
    <a href="{{ url_for('tables.detail', table_id=table.id) }}" class="btn btn-outline btn-sm">â† Back to Table</a>
</div>

<form method="POST">
    <div class="form-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" class="form-control"
               value="{{ note.title if note else '' }}" placeholder="Note title..." required>
    </div>

    <!-- Style Toolbar -->
    <div class="editor-toolbar">
        <div class="form-group">
            <label>Background Color</label>
            <div class="color-input-wrapper">
                <input type="color" id="bg_color" name="bg_color" value="{{ bg_color }}">
                <span id="bg_color_label" style="font-size:0.8rem; color:var(--text-muted);">{{ bg_color }}</span>
            </div>
        </div>
        <div class="form-group">
            <label>Text Color</label>
            <div class="color-input-wrapper">
                <input type="color" id="text_color" name="text_color" value="{{ text_color }}">
                <span id="text_color_label" style="font-size:0.8rem; color:var(--text-muted);">{{ text_color }}</span>
            </div>
        </div>
        <div class="form-group">
            <label>Font Size (px)</label>
            <input type="number" id="font_size" name="font_size" class="form-control font-size-input"
                   value="{{ font_size }}" min="10" max="32" step="1">
        </div>
    </div>

    <!-- Markdown Help -->
    <details style="margin-bottom: 1rem;">
        <summary style="cursor: pointer; color: var(--accent); font-size: 0.85rem;">ğŸ“– Markdown cheat sheet</summary>
        <div class="card" style="margin-top: 0.5rem; font-size: 0.85rem;">
            <code># Heading 1</code> Â· <code>## Heading 2</code> Â· <code>### Heading 3</code><br>
            <code>**bold**</code> Â· <code>*italic*</code> Â· <code>~~strikethrough~~</code><br>
            <code>- list item</code> Â· <code>1. numbered item</code><br>
            <code>> blockquote</code><br>
            <code>`inline code`</code> Â· <code>```code block```</code><br>
            <code>[link text](url)</code> Â· <code>---</code> horizontal rule
        </div>
    </details>

    <!-- Textarea with live preview colors -->
    <div class="note-textarea-wrapper">
        <textarea id="content" name="content" class="note-textarea"
                  placeholder="Write your notes here... Markdown is supported!"
                  style="background: {{ bg_color }}; color: {{ text_color }}; font-size: {{ font_size }}px;"
                  >{{ content | default('') }}</textarea>
    </div>

    <div style="margin-top: 1rem;">
        <button type="submit" class="btn btn-primary">
            {{ 'ğŸ’¾ Save Changes' if mode == 'edit' else 'âœ¨ Create Note' }}
        </button>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    const textarea = document.getElementById('content');
    const bgInput = document.getElementById('bg_color');
    const textInput = document.getElementById('text_color');
    const fontInput = document.getElementById('font_size');
    const bgLabel = document.getElementById('bg_color_label');
    const textLabel = document.getElementById('text_color_label');

    bgInput.addEventListener('input', () => {
        textarea.style.background = bgInput.value;
        bgLabel.textContent = bgInput.value;
    });

    textInput.addEventListener('input', () => {
        textarea.style.color = textInput.value;
        textLabel.textContent = textInput.value;
    });

    fontInput.addEventListener('input', () => {
        const size = Math.max(10, Math.min(32, parseInt(fontInput.value) || 16));
        textarea.style.fontSize = size + 'px';
    });
</script>
{% endblock %}
